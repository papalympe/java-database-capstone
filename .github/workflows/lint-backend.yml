name: Lint Java Backend

on: [push, pull_request]

jobs:
  lint-java:
    runs-on: ubuntu-latest
    name: Checkstyle Java Linting
    steps:
      - uses: actions/checkout@v3

      - name: Set up JDK
        uses: actions/setup-java@v4
        with:
          distribution: 'temurin'
          java-version: '17'

      - name: Create tools directory
        run: mkdir -p tools

      - name: Download Checkstyle (standalone jar)
        run: |
          # Set a Checkstyle version to download; change if you want a specific release
          CHECKSTYLE_VERSION=10.12.3
          curl -sSL -o tools/checkstyle-${CHECKSTYLE_VERSION}-all.jar \
            "https://github.com/checkstyle/checkstyle/releases/download/checkstyle-${CHECKSTYLE_VERSION}/checkstyle-${CHECKSTYLE_VERSION}-all.jar"

      - name: Download google_checks.xml ruleset
        run: |
          # Download the default Google ruleset (you can replace with a customized config later)
          curl -sSL -o tools/google_checks.xml \
            https://raw.githubusercontent.com/checkstyle/checkstyle/master/src/main/resources/google_checks.xml

      - name: Run Checkstyle on back-end Java sources
        run: |
          # Path to the downloaded jar (use the same version variable as above)
          CHECKSTYLE_JAR=tools/checkstyle-10.12.3-all.jar
          TARGET_DIR=app/src/main/java/com/project/back_end

          if [ -d "$TARGET_DIR" ]; then
            echo "Running Checkstyle against $TARGET_DIR"
            java -jar "$CHECKSTYLE_JAR" -c tools/google_checks.xml -r "$TARGET_DIR" || true
          else
            echo "Target directory $TARGET_DIR not found; skipping Checkstyle run"
          fi
